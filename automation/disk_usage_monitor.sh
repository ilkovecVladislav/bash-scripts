#!/bin/bash

# Массив файловых систем, которые нужно отслеживать (монтированные точки)
filesystems=("/", "/home", "/var")

# Файл оповещения
alert_file="/alert.txt"
> "$alert_file"  # Очистка (или создание) файла оповещений

# Цикл по каждому указанному разделу
for fs in "${filesystems[@]}"; do
  # Получаем процент использования с помощью df + awk + cut
  usage=$(df -h "$fs" | tail -1 | awk '{print $5}' | cut -d'%' -f1)

  # Проверка: больше или равно 90%
  if [ "$usage" -ge 90 ]; then
    echo "⚠️ Внимание: файловая система '$fs' использует $usage% дискового пространства!" >> "$alert_file"
  fi
done

# Проверка, был ли добавлен хотя бы один алерт
if [ -s "$alert_file" ]; then
  echo "Создан файл предупреждений: $alert_file"
else
  echo "Все файловые системы в норме. Удаление пустого файла оповещения."
  rm -f "$alert_file"
fi
