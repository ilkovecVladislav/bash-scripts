#!/bin/bash

# Файловые системы для мониторинга
filesystems=("/" "/home" "/var" "/tmp")

# Файл для предупреждений
alert_file="/alert.txt"

# Очищаем предыдущие предупреждения
> "$alert_file"

echo "Начало проверки дискового пространства: $(date)"

# Проверяем каждую файловую систему
for fs in "${filesystems[@]}"; do
    # Получаем процент использования для файловой системы
    usage=$(df -h "$fs" | tail -1 | awk '{print $5}' | cut -d'%' -f1)
    
    echo "Файловая система $fs использует $usage% пространства"
    
    # Проверяем превышение порога
    if [ "$usage" -ge 90 ]; then
        warning="ВНИМАНИЕ: Файловая система $fs использует ${usage}% пространства (превышен порог 90%)"
        echo "$warning" >> "$alert_file"
        echo "$warning"
    fi
done

# Проверяем, были ли предупреждения
if [ -s "$alert_file" ]; then
    echo "Обнаружены проблемы с дисковым пространством. Подробности в $alert_file"
else
    echo "Все файловые системы в норме (использование < 90%)"
    rm -f "$alert_file"
fi